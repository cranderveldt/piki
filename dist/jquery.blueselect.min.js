(function(i){i.fn.piki=function(e){var t=i.extend({icon:"&varr;",skin:"default"},e);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var a={"default":'<style>.piki-container{display:inline-block;*vertical-align:auto;zoom:1;*display:inline;position:relative}.piki-search,.piki-options{display:none}.piki-options{box-sizing:border-box;position:absolute;top:26px;left:0;max-height:200px;overflow-y:scroll;width:100%;background:#FFF;border:1px solid #a6a6a6;text-align:left}.piki-options ul{margin:0;list-style:none;padding:0}.piki-options ul li{display:none;margin:0;list-style:none;padding:5px;cursor:pointer}.piki-options ul li.piki-match{display:block}.piki-options ul li.piki-highlight{background:#d4eef8}.piki-search-field{box-sizing:border-box;width:100%;padding:5px 10px;margin:0}.piki-select{display:inline-block;*vertical-align:auto;zoom:1;*display:inline;box-sizing:border-box;width:100%;border:1px solid #a6a6a6;background-color:#f2f2f2;background-position:0 0;background-repeat:repeat-x;background-image:url("fallback.png");background-image:-webkit-gradient(linear, left top, left bottom, from(#fff), to(#f2f2f2));background-image:-webkit-linear-gradient(top, #fff, #f2f2f2);background-image:-moz-linear-gradient(top, #fff, #f2f2f2);background-image:-o-linear-gradient(top, #fff, #f2f2f2);background-image:linear-gradient(to bottom, #ffffff,#f2f2f2);cursor:default;border-radius:5px;font:-webkit-small-control;padding:2px 15px 3px 5px;cursor:pointer}.piki-icon{position:absolute;top:3px;right:5px}</style>'};return i("body").prepend(a[t.skin]),this.each(function(){var e=i(this),a='<div class="piki-container"><div class="piki-select">',n=e.find("option:selected").text();""===n.trim()&&(n="&nbsp;"),a=a+'<div class="piki-title" data-piki-default="'+n+'">'+n+"</div>"+'<span class="piki-icon">'+t.icon+"</span>"+"</div>"+'<div class="piki-search">'+'<input class="piki-search-field" type="text" placeholder="Search for options" />'+"</div>"+'<div class="piki-options">'+"<ul>",e.find('option[disabled!="disabled"]').each(function(){if(""!==i(this).text().trim()){var e=i(this),t="";i.each(this.attributes,function(i,e){var a=e.name,n=e.value;t=t+" data-piki-"+a+'="'+n+'"'}),a=a+'<li class="piki-match"'+t+">"+e.text()+"</li>"}}),a=a+"</ul>"+"</div>"+"</div>",e.hide().after(a);var o=e.next(),s=function(e){var t=e.find(".piki-highlight").data("piki-selected","selected").removeClass("piki-highlight").siblings().data("piki-selected","").addClass("piki-match").end();if(t.length>0)e.find(".piki-title").text(t.text()),e.find('option[value="'+t.data("piki-value")+'"]').prop("selected","selected");else{var a=e.find(".piki-title");a.text(a.data("piki-default"))}i("body").off(),e.find(".piki-select").show().siblings().hide(),e.find(".piki-search-field").val("")},l=function(e,t){var a=e.find(".piki-highlight"),n=e.find(".piki-match");if(a.length>0){if(n.length>1){var o=n.index(a),s=i(n[o+t]);void 0===s&&(s=a),a.removeClass("piki-highlight"),s.addClass("piki-highlight")}}else e.find(".piki-match").length>0&&e.find(".piki-match:first").addClass("piki-highlight")};o.on("keypress",".piki-search-field",function(i){(13===i.keyCode||38===i.keyCode||40===i.keyCode)&&i.preventDefault()}),o.on("keyup",".piki-search-field",function(e){var t=!1,a=i(this).parent().parent(),n=a.find(".piki-options ul li");13===e.keyCode&&s(a);var o=i(this).val().toLowerCase();n.each(function(){var e=i(this).text().toLowerCase();-1===e.indexOf(o)?i(this).removeClass("piki-match"):i(this).addClass("piki-match")}),38===e.keyCode&&(t=!0,l(a,-1)),40===e.keyCode&&(t=!0,l(a,1)),t||a.find(".piki-match:first").addClass("piki-highlight").siblings().removeClass("piki-highlight")}),o.on("click",".piki-match",function(){i(this).addClass("piki-highlight").siblings().removeClass("piki-highlight"),s(i(this).parent().parent().parent())}),o.on("click",".piki-select",function(){i(this).hide().siblings().show().end().parent().find(".piki-search-field").focus();var e=i(this).parent();i("body").on("click",function(t){var a=!1;i(t.target).parents().each(function(){this===e.get(0)&&(a=!0)}),a||(i("body").off(),o.find(".piki-select").show().siblings().hide())})})})}})(jQuery);