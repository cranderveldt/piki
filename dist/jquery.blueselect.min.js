(function(i){i.fn.piki=function(t){var e=i.extend({icon:"&varr;",skin:"default"},t);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var a={"default":'<style>.piki-container{display:inline-block;*vertical-align:auto;zoom:1;*display:inline;position:relative}.piki-search,.piki-options{display:none}.piki-options{box-sizing:border-box;position:absolute;top:26px;left:0;max-height:200px;overflow-y:scroll;width:100%;background:#FFF;border:1px solid #a6a6a6;text-align:left}.piki-options ul{margin:0;list-style:none;padding:0}.piki-options ul li{display:none;margin:0;list-style:none;padding:5px}.piki-options ul li.piki-match{display:block}.piki-options ul li.piki-highlight{background:#d4eef8}.piki-search-field{box-sizing:border-box;width:100%;padding:5px 10px;margin:0}.piki-select{display:inline-block;*vertical-align:auto;zoom:1;*display:inline;box-sizing:border-box;width:100%;border:1px solid #a6a6a6;background-color:#f2f2f2;background-position:0 0;background-repeat:repeat-x;background-image:url("fallback.png");background-image:-webkit-gradient(linear, left top, left bottom, from(#fff), to(#f2f2f2));background-image:-webkit-linear-gradient(top, #fff, #f2f2f2);background-image:-moz-linear-gradient(top, #fff, #f2f2f2);background-image:-o-linear-gradient(top, #fff, #f2f2f2);background-image:linear-gradient(to bottom, #ffffff,#f2f2f2);cursor:default;border-radius:5px;font:-webkit-small-control;padding:2px 15px 3px 5px}.piki-icon{position:absolute;top:3px;right:5px}</style>'};return i("body").prepend(a[e.skin]),this.each(function(){var t=i(this),a='<div class="piki-container"><div class="piki-select">',n=t.find("option:selected").text();""===n.trim()&&(n="&nbsp;"),a=a+'<div class="piki-title" data-piki-default="'+n+'">'+n+"</div>"+'<span class="piki-icon">'+e.icon+"</span>"+"</div>"+'<div class="piki-search">'+'<input class="piki-search-field" type="text" placeholder="Search for options" />'+"</div>"+'<div class="piki-options">'+"<ul>",t.find('option[disabled!="disabled"]').each(function(){var t=i(this),e="";i.each(this.attributes,function(i,t){var a=t.name,n=t.value;e=e+" data-piki-"+a+'="'+n+'"'}),a=a+'<li class="piki-match"'+e+">"+t.text()+"</li>"}),a=a+"</ul>"+"</div>"+"</div>",t.hide().after(a);var o=t.next(),l=function(t){var e=t.find(".piki-highlight").data("piki-selected","selected").removeClass("piki-highlight").siblings().data("piki-selected","").addClass("piki-match").end();if(e.length>0)t.find(".piki-title").text(e.text()),t.find('option[value="'+e.data("piki-value")+'"]').prop("selected","selected");else{var a=t.find(".piki-title");a.text(a.data("piki-default"))}i("body").off(),t.find(".piki-select").show().siblings().hide(),t.find(".piki-search-field").val("")},s=function(i){var t=i.find(".piki-highlight");if(t.length>0){var e=t.next(".piki-match");e.length>0&&(t.removeClass("piki-highlight").next(".piki-match").addClass("piki-highlight"),e.scrollTop(1e3))}else i.find(".piki-match").length>0&&i.find(".piki-match:first").addClass("piki-highlight")},p=function(i){var t=i.find(".piki-highlight");if(t.length>0){var e=t.prev(".piki-match");e.length>0&&t.removeClass("piki-highlight").prev(".piki-match").addClass("piki-highlight")}else i.find(".piki-match").length>0&&i.find(".piki-match:first").addClass("piki-highlight")};o.on("keypress",".piki-search-field",function(i){(13===i.keyCode||38===i.keyCode||40===i.keyCode)&&i.preventDefault()}),o.on("keyup",".piki-search-field",function(t){var e=!1,a=i(this).parent().parent(),n=a.find(".piki-options ul li");13===t.keyCode&&l(a);var o=i(this).val().toLowerCase();n.each(function(){var t=i(this).text().toLowerCase();-1===t.indexOf(o)?i(this).removeClass("piki-match"):i(this).addClass("piki-match")}),38===t.keyCode&&(e=!0,p(a)),40===t.keyCode&&(e=!0,s(a)),e||a.find(".piki-match:first").addClass("piki-highlight").siblings().removeClass("piki-highlight")}),o.on("click",".piki-match",function(){i(this).addClass("piki-highlight").siblings().removeClass("piki-highlight"),l(i(this).parent().parent().parent())}),o.on("click",".piki-select",function(){i(this).hide().siblings().show().end().parent().find(".piki-search-field").focus();var t=i(this).parent();i("body").on("click",function(e){var a=!1;i(e.target).parents().each(function(){this===t.get(0)&&(a=!0)}),a||(i("body").off(),o.find(".piki-select").show().siblings().hide())})})})}})(jQuery);